<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>To-do List App</title>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	
	<script> 
		REUSABLES = {
			updateList: function (response) {
				$("#todolistcomponent").empty();
				var $ul = $("<ul>").appendTo($("#todolistcomponent"));
				data = $.parseJSON(response);
				console.log(data);
				$.each(data, function(i, item) {
					var $li = $("<li>").text(item.title).appendTo($ul);
					$li.append(" - ");
					var $i = $("<i>").text(item.description).appendTo($li);
					$li.append(" : ");
					var $deleteButton = $("<button>").text("Delete").appendTo($li);
					$deleteButton.addClass('deleteButton');
					$deleteButton.data('id', item.id);
				});
			}
		}
		
		$(document).ready(
				$.get("story", function(response) {
					REUSABLES.updateList(response)	
				})
		);
		
		$(document).on("click", "#submitButton", function() {
			var params = {};
			params["title"] = $("#todoTitle").val();
			params["description"] = $("#todoDecsription").val();
			$.post("story", $.param(params), function(response) {
				REUSABLES.updateList(response)
			});
		});
		
		$(document).on("click", ".deleteButton", function() {
			var params = {};
			params["id"] = $(this).data('id');
			
			$.ajax({
			    url: "/SimpleWebApp/story" + '?' + $.param({"id": $(this).data('id')}),
			    type: 'DELETE',
			    success: function(response){
			    		REUSABLES.updateList(response)
				}
			});
		});	
	</script>	
</head>

<body>
	<div id = "todolistcomponent"> </div>
	
	<form>
		Title
		<input type="text" id="todoTitle"><br>
		Description
		<input type="text" id="todoDecsription"><br>
  		<input id = "submitButton" type="submit" value="Submit">
	</form>
</body>
</html>

