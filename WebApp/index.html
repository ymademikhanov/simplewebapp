<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>To-do List App</title>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css"
      rel="stylesheet">
	<script> 
	
		REUSABLES = {
			generateCard: function(item) {
				var $card = $("<div>");
				$card.addClass("card");
				var $cardBlock = $("<div>");
				$cardBlock.addClass("card-block");
				var $h4 = $("<h4>");
				$h4.addClass("card-title");
				$h4.text(unescape(item.title));
				var $h6 = $("<h6>");
				$h6.addClass("card-subtitle");
				$h6.text("id: " + item.id);
				var $p = $("<p>");
				$p.addClass("card-text");
				$p.text(unescape(item.description));
				
				var $deleteButton = $("<button>").text("Delete");
				$deleteButton.addClass('deleteButton');
				$deleteButton.addClass('btn btn-danger');
				$deleteButton.data('id', item.id);
				
				$card.append($cardBlock);
				$cardBlock.append($h4);
				$cardBlock.append($h6);
				$cardBlock.append($p);
				$cardBlock.append($deleteButton);
				return $card;
			},
			updateList: function (response) {
				var $ul = $("<ul>").addClass("list-group");
				var count = 0;
				
				data = $.parseJSON(response);
				
				$.each(data, function(i, item) {
					var $li = $("<li>").addClass("list-group-item").appendTo($ul);
					$li.append(REUSABLES.generateCard(item));
					count = count + 1;
				});
				
				$("#todolistcomponent").empty();
				if (count > 0) {
					$("#todolistcomponent").append("<h2>Your todo list:</h2>");
					$("#todolistcomponent").append($ul);
				} else {
					$("#todolistcomponent").append("<h2>Empty list.</h2>")
				}
			}
		}
		
		$(document).ready(
			$.get("/SimpleWebApp/services/todo", function(data, textStatus, request) {
				REUSABLES.updateList(data);
			})
		);
		
		$(document).on("click", "#submitButton", function(e) {
			var params = {
				"title" : escape($("#todoTitle").val()),
				"description" : escape($("#todoDescription").val())
			};
			
			$("#todoTitle").val("");
			$("#todoDescription").val("");
			
			$.ajax ({
		        type: "POST",
		        url: '/SimpleWebApp/services/todo',
		        contentType: 'application/json',
		        async: false,
		        //json object to sent to the authentication url
		        data: JSON.stringify(params),
		        success: function (response) {
					REUSABLES.updateList(response);
		        }
		    })
		});
		
		$(document).on("click", ".deleteButton", function() {
			$.ajax({
			    url: "/SimpleWebApp/services/todo?id=" + $(this).data('id'),
			    type: 'DELETE',
			    success: function(response) {
					REUSABLES.updateList(response);	
				}
			});
		});	
	</script>	
</head>

<body style="padding:10px; display: table-cell; vertical-align: middle; height: 100%;  display: table;
    margin: auto;">
	<div id = "todolistcomponent" style="width:500px"> Empty list. </div>
	<br/>
	
	<h2> A new todo: </h2>
	<form class="form-signin">
		<input id="todoTitle" class="form-control" placeholder="Title" name="title" style="margin-top:2px;">
		<input id="todoDescription" class="form-control" name = "description" placeholder="Description" style="margin-top:2px;">
  		<button  class="btn btn-lg btn-primary btn-block" type="button" id = "submitButton" style="margin-top: 5px">Add</button>
	</form>
	
	<br />
	<br />
	<br />
	<p>
			<b>An example on how to get specific task:</b>
	</p>
	
		<p>
			localhost:8080/SimpleWebApp/story/3
	</p>
	
	<p>
			<b>General template: </b>
	</p>
	
	<p>
			localhost:{port : integer}/SimpleWebApp/story/{id : integer}
	</p>
</body>
</html>


