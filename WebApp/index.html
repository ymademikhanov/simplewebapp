<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>To-do List App</title>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	
	<script> 
		REUSABLES = {
			updateList: function (response) {
				
				var $ul = $("<ul>");
				var count = 0;
				data = $.parseJSON(response);
				console.log(data);
				$.each(data, function(i, item) {
					var $li = $("<li>").text(item.title).appendTo($ul);
					$li.append(" - ");
					var $i = $("<i>").text(item.description).appendTo($li);
					$li.append(" : ");
					var $deleteButton = $("<button>").text("Delete").appendTo($li);
					$li.append(" Element ID is " + item.id)
					$deleteButton.addClass('deleteButton');
					$deleteButton.data('id', item.id);
					count = count + 1;
				});
				
				$("#todolistcomponent").empty();
				if (count > 0) {
					$("#todolistcomponent").append($ul);
				} else {
					$("#todolistcomponent").text("Empty list.")
				}
			}
		}
		
		$(document).ready(
				$.get("story", function(response) {
					REUSABLES.updateList(response)	
				})
		);
		
		$(document).on("click", "#submitButton", function() {
			var params = {
					"title" : $("#todoTitle").val(),
					"description" : $("#todoDecsription").val()
			};
			$.post("story", $.param(params), function(response) {
				REUSABLES.updateList(response)
			});
		});
		
		$(document).on("click", ".deleteButton", function() {
			var params = {};
			params["id"] = $(this).data('id');
			
			$.ajax({
			    url: "/SimpleWebApp/story" + '?' + $.param({"id": $(this).data('id')}),
			    type: 'DELETE',
			    success: function(response){
			    		REUSABLES.updateList(response)
				}
			});
		});	
	</script>	
</head>

<body>
	<div id = "todolistcomponent"> Empty list. </div>
	<br>
	
	<form>
		Title
		<input type="text" id="todoTitle"><br>
		Description
		<input type="text" id="todoDecsription"><br>
  		<input id = "submitButton" type="submit" value="Submit">
	</form>
	
	<p>
			<b>An example on how to get specific task:</b>
	</p>
	<p>
			localhost:8080/SimpleWebApp/story/3
	</p>
	
	<p>
			<b>General template: </b>
	</p>
	
	<p>
			localhost:{port : integer}/SimpleWebApp/story/{id : integer}
	</p>
</body>
</html>

